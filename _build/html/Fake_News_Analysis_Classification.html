
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fake News Analysis and Detection with Naive Bayes &#8212; Fake News Analysis and Detection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Fake_News_Analysis_Classification';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Fake News: Analysis and Detection" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Fake News Analysis and Detection - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Fake News Analysis and Detection - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Fake News: Analysis and Detection
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Fake News Analysis and Detection with Naive Bayes</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Fake-News-Analysis-Detection" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Fake-News-Analysis-Detection/issues/new?title=Issue%20on%20page%20%2FFake_News_Analysis_Classification.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Fake_News_Analysis_Classification.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fake News Analysis and Detection with Naive Bayes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction"><strong>Introduction</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><strong>Data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-topics"><strong>News topics</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-types"><strong>News types</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-words-per-news-type"><strong>Number of words per news type</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer"><strong>Tokenizer</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stopwords"><strong>Stopwords</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-tokens"><strong>Computing Tokens</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-number-of-tokens-per-news-type"><strong>Average number of tokens per news type</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-frequency"><strong>Top tokens per news type based on frequency</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-ratio"><strong>Odds Ratio</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-odds-ratio"><strong>Top tokens per news type based on Odds Ratio</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#term-frequecy-inverse-document-frequency"><strong>Term Frequecy - Inverse Document Frequency</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-tf-idf-with-a-toy-example"><strong>Understanding TF-IDF with a toy example</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-tf-idf"><strong>Computing TF-IDF</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-tf-idf"><strong>Top tokens per news type based on TF-IDF</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-our-tf-idf-values"><strong>Using our TF-IDF values</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-classification"><strong>News Classification</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes-classifiers"><strong>Naive Bayes Classifiers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-naive-bayes"><strong>Gaussian Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multinomial-naive-bayes"><strong>Multinomial Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bernoulli-naive-bayes"><strong>Bernoulli Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-naive-bayes"><strong>Categorical Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complement-naive-bayes"><strong>Complement Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tf-idf-naive-classifier"><strong>TF-IDF Naive Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-and-response-definition"><strong>Predictors and Response Definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-inner-evaluation-definition"><strong>Outer-Inner Evaluation Definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines"><strong>Pipelines</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-grids"><strong>Parameter Grids</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hyper-parameter-optimization-hpo"><strong>Hyper-parameter Optimization (HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-tf-idf-classifier"><strong>Naive TF-IDF Classifier</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-classifier"><strong>KNN Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-naive-bayes-classifier"><strong>Gaussian Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multinomial-naive-bayes-classifier"><strong>Multinomial Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complement-multinomial-naive-bayes-classifier"><strong>Complement Multinomial Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bernoulli-naive-bayes-classifier"><strong>Bernoulli Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance">Estimation of future performance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis"><strong>Sentiment Analysis</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="fake-news-analysis-and-detection-with-naive-bayes">
<h1><strong>Fake News Analysis and Detection with Naive Bayes</strong><a class="headerlink" href="#fake-news-analysis-and-detection-with-naive-bayes" title="Link to this heading">#</a></h1>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;stopwords&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.sentiment.vader</span> <span class="kn">import</span> <span class="n">SentimentIntensityAnalyzer</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;vader_lexicon&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span><span class="p">,</span> <span class="n">BernoulliNB</span><span class="p">,</span> <span class="n">CategoricalNB</span><span class="p">,</span> <span class="n">ComplementNB</span><span class="p">,</span> <span class="n">MultinomialNB</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">ClassifierMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\fscielzo\Documents\Packages\BigEDA_Package_Private&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">BigEDA.plots</span> <span class="kn">import</span> <span class="n">barplot</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\fscielzo\Documents\Packages\PyML_Package_Private&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyML.evaluation</span> <span class="kn">import</span> <span class="n">SimpleEvaluation</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Naive_TFIDF_Classifier</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_top_train</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_top_new</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_top_train</span> <span class="o">=</span> <span class="n">n_top_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_top_new</span> <span class="o">=</span> <span class="n">n_top_new</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_tokens_train_class_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="p">:</span>
            <span class="n">tfidf_mean_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="n">c</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">top_tokens_train_class_</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">tfidf_mean_class</span><span class="p">)[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_top_train</span><span class="p">]</span>        
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="n">Y_hat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  
            <span class="n">top_tokens_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">toarray</span><span class="p">())[</span><span class="mi">0</span><span class="p">][:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_top_new</span><span class="p">]</span>
            <span class="n">prop_matches</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="p">:</span>
                <span class="n">prop_matches</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_tokens_train_class_</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_tokens_new</span><span class="p">])</span> 

            <span class="n">prop_matches_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prop_matches</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">Y_hat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prop_matches_values</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SparseToDense</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">X</span>        
</pre></div>
</div>
</div>
</div>
</section>
<section id="introduction">
<h2><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In this work we will analyze and classify News as Fake or Not Fake, by applying  supervised classification algorithms, such as the naive Bayes classifier.</p>
</section>
<section id="data">
<h2><strong>Data</strong><a class="headerlink" href="#data" title="Link to this heading">#</a></h2>
<p>The data-set that we are going to use contains 44898 News about American politics issues between 31 March 2015 and 18 february 2018. Some of them are Fake News, others not, and we have this information in a variable, which will be the response variable.</p>
<p>This data-set was download from <code class="docutils literal notranslate"><span class="pre">Kaggle</span></code>, but the its link is not available anymore.</p>
<p>We load the data an create the response variable, which indicates if the news is Fake (1) or not (0).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fake_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Fake.csv&#39;</span><span class="p">)</span>
<span class="n">true_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;True.csv&#39;</span><span class="p">)</span>
<span class="n">df_True</span> <span class="o">=</span> <span class="n">true_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_df</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">))</span>
<span class="n">df_Fake</span> <span class="o">=</span> <span class="n">fake_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fake_df</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">))</span>
<span class="n">news_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_Fake</span><span class="p">,</span> <span class="n">df_True</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

<span class="c1"># Fake = 0 = False --&gt; True News</span>
<span class="c1"># Fake = 1 = Yes --&gt; Fake News</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">news_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 5)</small><table border="1" class="dataframe"><thead><tr><th>title</th><th>text</th><th>subject</th><th>date</th><th>Fake</th></tr><tr><td>str</td><td>str</td><td>str</td><td>str</td><td>i32</td></tr></thead><tbody><tr><td>&quot;Donald Trump S…</td><td>&quot;Donald Trump j…</td><td>&quot;News&quot;</td><td>&quot;December 31, 2…</td><td>1</td></tr><tr><td>&quot;Drunk Bragging…</td><td>&quot;House Intellig…</td><td>&quot;News&quot;</td><td>&quot;December 31, 2…</td><td>1</td></tr><tr><td>&quot;Sheriff David …</td><td>&quot;On Friday, it …</td><td>&quot;News&quot;</td><td>&quot;December 30, 2…</td><td>1</td></tr><tr><td>&quot;Trump Is So Ob…</td><td>&quot;On Christmas d…</td><td>&quot;News&quot;</td><td>&quot;December 29, 2…</td><td>1</td></tr><tr><td>&quot;Pope Francis J…</td><td>&quot;Pope Francis u…</td><td>&quot;News&quot;</td><td>&quot;December 25, 2…</td><td>1</td></tr><tr><td>&quot;Racist Alabama…</td><td>&quot;The number of …</td><td>&quot;News&quot;</td><td>&quot;December 25, 2…</td><td>1</td></tr><tr><td>&quot; Fresh Off The…</td><td>&quot;Donald Trump s…</td><td>&quot;News&quot;</td><td>&quot;December 23, 2…</td><td>1</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">news_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(44898, 5)
</pre></div>
</div>
</div>
</div>
</section>
<section id="news-topics">
<h2><strong>News topics</strong><a class="headerlink" href="#news-topics" title="Link to this heading">#</a></h2>
<p>We can compute the weight (relative frequency) of the different topics covered in the news.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique_subjects</span><span class="p">,</span> <span class="n">count_subjects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">unique_subjects_sorted</span> <span class="o">=</span> <span class="n">unique_subjects</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">count_subjects</span><span class="p">)]</span>
<span class="n">freq_subjects_sorted</span> <span class="o">=</span> <span class="n">count_subjects</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">count_subjects</span><span class="p">)]</span>
<span class="n">rel_freq_subjects_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freq_subjects_sorted</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">freq_subjects_sorted</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">news_subjects_rel_freq</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;subjects&#39;</span><span class="p">:</span><span class="n">unique_subjects_sorted</span><span class="p">,</span> <span class="s1">&#39;rel_freq_%&#39;</span><span class="p">:</span><span class="n">rel_freq_subjects_sorted</span><span class="p">})</span>
<span class="n">news_subjects_rel_freq</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8, 2)</small><table border="1" class="dataframe"><thead><tr><th>subjects</th><th>rel_freq_%</th></tr><tr><td>str</td><td>f64</td></tr></thead><tbody><tr><td>&quot;politicsNews&quot;</td><td>25.1</td></tr><tr><td>&quot;worldnews&quot;</td><td>22.6</td></tr><tr><td>&quot;News&quot;</td><td>20.2</td></tr><tr><td>&quot;politics&quot;</td><td>15.2</td></tr><tr><td>&quot;left-news&quot;</td><td>9.9</td></tr><tr><td>&quot;Government New…</td><td>3.5</td></tr><tr><td>&quot;US_News&quot;</td><td>1.7</td></tr><tr><td>&quot;Middle-east&quot;</td><td>1.7</td></tr></tbody></table></div></div></div>
</div>
<p>As you we can see, the most part of the news are about politics, focus on the USA scenario, but there are also a significance amount of world news.</p>
</section>
<section id="news-types">
<h2><strong>News types</strong><a class="headerlink" href="#news-types" title="Link to this heading">#</a></h2>
<p>We visualize the weight (relative frequencies) of both news types (fake and not fake).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">barplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;Fake&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  
        <span class="n">y_up_limit</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Fake&#39;</span><span class="p">,</span> <span class="n">xlabel_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">title_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fake = 1 = Yes --&gt; Fake News </span><span class="se">\n</span><span class="s1">Fake = 0 = False --&gt; Not Fake News&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8fe88ceb23f459dfce4253d5d2b77a975dab18f5fff517299a645a14f5fec491.png" src="_images/8fe88ceb23f459dfce4253d5d2b77a975dab18f5fff517299a645a14f5fec491.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fake = 1 = Yes --&gt; Fake News 
Fake = 0 = False --&gt; Not Fake News
</pre></div>
</div>
</div>
</div>
<p>We can see that both classes are well balance, since we have 52% of fake news and 48% of not fake.</p>
</section>
<section id="number-of-words-per-news-type">
<h2><strong>Number of words per news type</strong><a class="headerlink" href="#number-of-words-per-news-type" title="Link to this heading">#</a></h2>
<p>Computing the number of words of each document and grouping by <code class="docutils literal notranslate"><span class="pre">Fake</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">n_news</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<span class="n">words_count</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_news</span><span class="p">)]</span>
<span class="n">news_df</span> <span class="o">=</span> <span class="n">news_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">words_count</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;words_count&#39;</span><span class="p">))</span>
<span class="n">news_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;words_count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small><table border="1" class="dataframe"><thead><tr><th>Fake</th><th>words_count</th></tr><tr><td>i32</td><td>f64</td></tr></thead><tbody><tr><td>0</td><td>385.640099</td></tr><tr><td>1</td><td>423.197905</td></tr></tbody></table></div></div></div>
</div>
<p>We can see that hte fake news has, on average, 423 words, and the not fake 385.</p>
</section>
<section id="tokenizer">
<h2><strong>Tokenizer</strong><a class="headerlink" href="#tokenizer" title="Link to this heading">#</a></h2>
<p>Defining a tokenizer, that is, a function that takes text as input and return the tokens of that text as output.</p>
<p>This tokenizer is going to define what is a token a what is not. In general terms a token will be a word that fulfill certain conditions, in this case the ones that define our <code class="docutils literal notranslate"><span class="pre">tokenizer</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">:</span>
    
    <span class="c1"># Text is converted to lowercase.</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># Removing web pages links.</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;http\S+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c1"># Removing  punctuation marks.</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s1">&#39;[</span><span class="se">\\</span><span class="s1">!</span><span class="se">\\</span><span class="s1">&quot;</span><span class="se">\\</span><span class="s1">#</span><span class="se">\\</span><span class="s1">$</span><span class="se">\\</span><span class="s1">%</span><span class="se">\\</span><span class="s1">&amp;</span><span class="se">\\\&#39;\\</span><span class="s1">(</span><span class="se">\\</span><span class="s1">)</span><span class="se">\\</span><span class="s1">*</span><span class="se">\\</span><span class="s1">+</span><span class="se">\\</span><span class="s1">,</span><span class="se">\\</span><span class="s1">-</span><span class="se">\\</span><span class="s1">.</span><span class="se">\\</span><span class="s1">/</span><span class="se">\\</span><span class="s1">:</span><span class="se">\\</span><span class="s1">;</span><span class="se">\\</span><span class="s1">&lt;</span><span class="se">\\</span><span class="s1">=</span><span class="se">\\</span><span class="s1">&gt;</span><span class="se">\\</span><span class="s1">?</span><span class="se">\\</span><span class="s1">@</span><span class="se">\\</span><span class="s1">[</span><span class="se">\\\\\\</span><span class="s1">]</span><span class="se">\\</span><span class="s1">^_</span><span class="se">\\</span><span class="s1">`</span><span class="se">\\</span><span class="s1">{</span><span class="se">\\</span><span class="s1">|</span><span class="se">\\</span><span class="s1">}</span><span class="se">\\</span><span class="s1">~]&#39;</span>    
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regex</span> <span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c1"># Removing numbers.</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c1"># Removing multiple white spaces.</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
    <span class="c1"># Tokenization based on individual words.</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="n">new_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="c1"># Removing tokens with length &lt;= 1</span>
    <span class="n">new_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">new_text</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">&gt;=</span>  <span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">new_text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:6: SyntaxWarning: invalid escape sequence &#39;\S&#39;
&lt;&gt;:11: SyntaxWarning: invalid escape sequence &#39;\d&#39;
&lt;&gt;:6: SyntaxWarning: invalid escape sequence &#39;\S&#39;
&lt;&gt;:11: SyntaxWarning: invalid escape sequence &#39;\d&#39;
C:\Users\fscielzo\AppData\Local\Temp\ipykernel_20212\2381969994.py:6: SyntaxWarning: invalid escape sequence &#39;\S&#39;
  new_text = re.sub(&#39;http\S+&#39;, &#39; &#39;, new_text)
C:\Users\fscielzo\AppData\Local\Temp\ipykernel_20212\2381969994.py:11: SyntaxWarning: invalid escape sequence &#39;\d&#39;
  new_text = re.sub(&quot;\d+&quot;, &#39; &#39;, new_text)
</pre></div>
</div>
</div>
</div>
<p>Example to show how this function works:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;My email is fabio@gmail.com. This project was carried out in 2024. The web page of this university is: https://www.uc3m.es/Home&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;my&#39;, &#39;email&#39;, &#39;is&#39;, &#39;fabio&#39;, &#39;gmail&#39;, &#39;com&#39;, &#39;this&#39;, &#39;project&#39;,
       &#39;was&#39;, &#39;carried&#39;, &#39;out&#39;, &#39;in&#39;, &#39;the&#39;, &#39;web&#39;, &#39;page&#39;, &#39;of&#39;, &#39;this&#39;,
       &#39;university&#39;, &#39;is&#39;], dtype=&#39;&lt;U10&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="stopwords">
<h2><strong>Stopwords</strong><a class="headerlink" href="#stopwords" title="Link to this heading">#</a></h2>
<p>Defining the stop words, that is, words that we will consider as not significative, so that, we will not be consider as tokens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stop_words</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;pic&quot;</span> <span class="p">,</span> <span class="s2">&quot;getty&quot;</span><span class="p">,</span> <span class="s2">&quot;quot&quot;</span><span class="p">,</span> <span class="s2">&quot;acr&quot;</span><span class="p">,</span> <span class="s2">&quot;filessupport&quot;</span><span class="p">,</span> <span class="s2">&quot;flickr&quot;</span><span class="p">,</span> <span class="s2">&quot;fjs&quot;</span><span class="p">,</span> <span class="s2">&quot;js&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;somodevilla&quot;</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;henningsen&quot;</span><span class="p">,</span><span class="s2">&quot;ck&quot;</span><span class="p">,</span> <span class="s2">&quot;cdata&quot;</span><span class="p">,</span> <span class="s2">&quot;subscribing&quot;</span><span class="p">,</span> <span class="s2">&quot;mcnamee&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;amp&quot;</span><span class="p">,</span> <span class="s2">&quot;wfb&quot;</span><span class="p">,</span> <span class="s2">&quot;screenshot&quot;</span><span class="p">,</span> <span class="s2">&quot;hesher&quot;</span><span class="p">,</span><span class="s2">&quot;nyp&quot;</span><span class="p">,</span> <span class="s2">&quot;cking&quot;</span><span class="p">,</span> <span class="s2">&quot;helton&quot;</span><span class="p">,</span> <span class="s2">&quot;raedle&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;donnell&quot;</span><span class="p">,</span> <span class="s2">&quot;getelementbyid&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;behar&quot;</span><span class="p">,</span> <span class="s2">&quot;createelement&quot;</span><span class="p">,</span> <span class="s2">&quot;getelementsbytagname&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;parentnode&quot;</span><span class="p">,</span> <span class="s2">&quot;wnd&quot;</span><span class="p">,</span><span class="s2">&quot;insertbefore&quot;</span><span class="p">,</span> <span class="s2">&quot;jssdk&quot;</span><span class="p">,</span> <span class="s2">&quot;nowicki&quot;</span><span class="p">,</span> <span class="s2">&quot;xfbml&quot;</span><span class="p">,</span> <span class="s2">&quot;camerota&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;sdk&quot;</span><span class="p">,</span>  <span class="s2">&quot;“i&quot;</span> <span class="p">,</span> <span class="s2">&quot;“the&quot;</span><span class="p">,</span> <span class="s2">&quot;“we&quot;</span><span class="p">,</span> <span class="s2">&quot;it’s&quot;</span><span class="p">,</span> <span class="s2">&quot;don’t&quot;</span><span class="p">,</span> <span class="s2">&quot;“this&quot;</span><span class="p">,</span> <span class="s2">&quot;“it&quot;</span><span class="p">,</span> <span class="s2">&quot;“a&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;“if&quot;</span><span class="p">,</span>  <span class="s2">&quot;“it’s&quot;</span><span class="p">,</span> <span class="s2">&quot;we’re&quot;</span><span class="p">,</span> <span class="s2">&quot;that’s&quot;</span><span class="p">,</span>  <span class="s2">&quot;“he&quot;</span><span class="p">,</span> <span class="s2">&quot;“there&quot;</span><span class="p">,</span> <span class="s2">&quot;i’m&quot;</span><span class="p">,</span>  <span class="s2">&quot;he’s&quot;</span><span class="p">,</span>  <span class="s2">&quot;“we’re&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;doesn’t&quot;</span><span class="p">,</span> <span class="s2">&quot;can’t&quot;</span><span class="p">,</span> <span class="s2">&quot;“i’m&quot;</span><span class="p">,</span> <span class="s2">&quot;“in&quot;</span><span class="p">,</span> <span class="s2">&quot;suu&quot;</span><span class="p">,</span> <span class="s2">&quot;“they&quot;</span><span class="p">,</span> <span class="s2">&quot;you’re&quot;</span><span class="p">,</span> <span class="s2">&quot;“but&quot;</span><span class="p">,</span> <span class="s2">&quot;didn’t&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;“you&quot;</span><span class="p">,</span> <span class="s2">&quot;they’re&quot;</span><span class="p">,</span> <span class="s2">&quot;“no&quot;</span><span class="p">,</span> <span class="s2">&quot;“as&quot;</span><span class="p">,</span> <span class="s2">&quot;“very&quot;</span> <span class="p">,</span> <span class="s2">&quot;there’s&quot;</span><span class="p">,</span> <span class="s2">&quot;“what&quot;</span><span class="p">,</span>  <span class="s2">&quot;“and&quot;</span><span class="p">,</span> <span class="s2">&quot;won’t&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;“to&quot;</span><span class="p">,</span> <span class="s2">&quot;“that&quot;</span><span class="p">,</span> <span class="s2">&quot;“one&quot;</span><span class="p">,</span> <span class="s2">&quot;we’ve&quot;</span><span class="p">,</span> <span class="s2">&quot;“when&quot;</span> <span class="p">,</span> <span class="s2">&quot;“our&quot;</span><span class="p">,</span> <span class="s2">&quot;“not&quot;</span><span class="p">,</span> <span class="s2">&quot;’”&quot;</span> <span class="p">,</span><span class="s2">&quot;“that’s&quot;</span><span class="p">,</span> 
                                           <span class="s2">&quot;“these&quot;</span><span class="p">,</span> <span class="s2">&quot;“there’s&quot;</span><span class="p">,</span> <span class="s2">&quot;“he’s&quot;</span><span class="p">,</span> <span class="s2">&quot;we’ll&quot;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;would&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;us&#39;</span><span class="p">,</span> <span class="s1">&#39;even&#39;</span><span class="p">,</span> 
                                           <span class="s1">&#39;could&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="s1">&#39;angerer&#39;</span><span class="p">,</span> <span class="s1">&#39;reilly&#39;</span><span class="p">,</span> <span class="s1">&#39;said&#39;</span><span class="p">,</span> <span class="s1">&#39;told&#39;</span><span class="p">,</span> <span class="s1">&#39;also&#39;</span><span class="p">,</span> <span class="s1">&#39;via&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-tokens">
<h2><strong>Computing Tokens</strong><a class="headerlink" href="#computing-tokens" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing the tokens for each document (news)</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map_elements</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span>
<span class="c1"># Adding the tokens and and ID for the documents (news) as variables</span>
<span class="n">news_df</span> <span class="o">=</span> <span class="n">news_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">),</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">news_df</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;text_id&#39;</span><span class="p">))</span>
<span class="c1"># Explode the data-frame by `tokens` column</span>
<span class="n">tokens_explode_df</span> <span class="o">=</span> <span class="n">news_df</span><span class="p">[[</span><span class="s1">&#39;text_id&#39;</span><span class="p">,</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Fake&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">])</span>
<span class="c1"># Removing stopwords form the tokens</span>
<span class="n">tokens_explode_df</span> <span class="o">=</span> <span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">stop_words</span><span class="p">))</span>
<span class="c1"># Computing the frequency (count) of each token grouped by `Fake` colum.</span>
<span class="n">tokens_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Fake&#39;</span><span class="p">]</span> <span class="p">)[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
<span class="c1"># Computing the frequency (count) of tokens per document (News)</span>
<span class="n">tokens_count</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_news</span><span class="p">)]</span>
<span class="c1"># Adding the las array as column of `news_df`</span>
<span class="n">news_df</span> <span class="o">=</span> <span class="n">news_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tokens_count</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;tokens_count&#39;</span><span class="p">))</span> 
<span class="c1"># Computing unique tokens and counting their frequency.</span>
<span class="n">unique_tokens</span><span class="p">,</span> <span class="n">count_tokens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tokens_explode_df</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Data-frame with the tokens, and their counts depending on the news type.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokens_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small><table border="1" class="dataframe"><thead><tr><th>tokens</th><th>Fake</th><th>count</th></tr><tr><td>str</td><td>i32</td><td>i64</td></tr></thead><tbody><tr><td>&quot;aa&quot;</td><td>0</td><td>22</td></tr><tr><td>&quot;aa&quot;</td><td>1</td><td>24</td></tr><tr><td>&quot;aaa&quot;</td><td>0</td><td>7</td></tr><tr><td>&quot;aaa&quot;</td><td>1</td><td>9</td></tr><tr><td>&quot;aaaaaaaand&quot;</td><td>0</td><td>0</td></tr></tbody></table></div></div></div>
</div>
<ul class="simple">
<li><p>Data-frame with all the tokens for each news. <code class="docutils literal notranslate"><span class="pre">text_id</span></code> is a variable for indexing the news.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small><table border="1" class="dataframe"><thead><tr><th>text_id</th><th>tokens</th><th>Fake</th></tr><tr><td>i32</td><td>str</td><td>i32</td></tr></thead><tbody><tr><td>0</td><td>&quot;donald&quot;</td><td>1</td></tr><tr><td>0</td><td>&quot;trump&quot;</td><td>1</td></tr><tr><td>0</td><td>&quot;wish&quot;</td><td>1</td></tr><tr><td>0</td><td>&quot;americans&quot;</td><td>1</td></tr><tr><td>0</td><td>&quot;happy&quot;</td><td>1</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small><table border="1" class="dataframe"><thead><tr><th>text_id</th><th>tokens</th><th>Fake</th></tr><tr><td>i32</td><td>str</td><td>i32</td></tr></thead><tbody><tr><td>44897</td><td>&quot;energy&quot;</td><td>0</td></tr><tr><td>44897</td><td>&quot;technology&quot;</td><td>0</td></tr><tr><td>44897</td><td>&quot;aviation&quot;</td><td>0</td></tr><tr><td>44897</td><td>&quot;among&quot;</td><td>0</td></tr><tr><td>44897</td><td>&quot;others&quot;</td><td>0</td></tr></tbody></table></div></div></div>
</div>
<p>The number of tokens (counting repetitions) is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">tokens_explode_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9977651
</pre></div>
</div>
</div>
</div>
<p>That is the same as the sum of the counts of all the tokens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tokens_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9977651
</pre></div>
</div>
</div>
</div>
<p>But the number of unique tokens is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_classes</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens_df</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_classes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>125562
</pre></div>
</div>
</div>
</div>
</section>
<section id="average-number-of-tokens-per-news-type">
<h2><strong>Average number of tokens per news type</strong><a class="headerlink" href="#average-number-of-tokens-per-news-type" title="Link to this heading">#</a></h2>
<p>We can compute the average number of tokens depending of the news type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of tokens grouped by `Fake` </span>
<span class="n">news_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;tokens_count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small><table border="1" class="dataframe"><thead><tr><th>Fake</th><th>tokens_count</th></tr><tr><td>i32</td><td>f64</td></tr></thead><tbody><tr><td>0</td><td>368.0</td></tr><tr><td>1</td><td>409.0</td></tr></tbody></table></div></div></div>
</div>
<p>Fake news has 409 tokens on average, and not fake 368.</p>
</section>
<section id="top-tokens-per-news-type-based-on-frequency">
<h2><strong>Top tokens per news type based on frequency</strong><a class="headerlink" href="#top-tokens-per-news-type-based-on-frequency" title="Link to this heading">#</a></h2>
<p>We compute the most frequent tokens depending on the news type, then we plot the top tokens in both groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing the most frequent tokens in Fake and not Fake news.</span>
<span class="n">top_fake_tokens_count</span> <span class="o">=</span> <span class="n">tokens_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">freq_top_fake_tokens_count</span> <span class="o">=</span> <span class="n">tokens_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">top_not_fake_tokens_count</span> <span class="o">=</span> <span class="n">tokens_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">freq_top_not_fake_tokens_count</span> <span class="o">=</span> <span class="n">tokens_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Barplots for top tokens</strong></p>
<p>Plotting the top 15 tokens in the fake and not fake news, based on frequencies, as a barplot.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_top</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">freq_top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">freq_top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tokens&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Top </span><span class="si">{</span><span class="n">n_top</span><span class="si">}</span><span class="s1"> tokens based on frequency&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7487d848ec045a96412e209296f7a550fc1ff1d89ca01155b42f652933e99ccb.png" src="_images/7487d848ec045a96412e209296f7a550fc1ff1d89ca01155b42f652933e99ccb.png" />
</div>
</div>
<ul class="simple">
<li><p>Computing the <strong>genuine</strong> fake and not fake tokens, namely, tokens that are in the top-15 fake tokens but not in the top-15 not fake tokens, and vice versa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genuine_top_fake_tokens_count_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>
<span class="n">genuine_top_not_fake_tokens_count_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>

<span class="n">genuine_top_fake_tokens_count</span> <span class="o">=</span> <span class="n">top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_count_idx</span><span class="p">]</span>
<span class="n">freq_genuine_top_fake_tokens_count</span> <span class="o">=</span> <span class="n">freq_top_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_count_idx</span><span class="p">]</span>

<span class="n">genuine_top_not_fake_tokens_count</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_count_idx</span><span class="p">]</span>
<span class="n">freq_genuine_top_not_fake_tokens_count</span> <span class="o">=</span> <span class="n">freq_top_not_fake_tokens_count</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_count_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Word clouds for genuine top tokens</strong></p>
<p>Plotting the top genuine tokens in the fake and not fake news as a word cloud.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_cloud_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">count</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_fake_tokens_count</span><span class="p">,</span> <span class="n">freq_genuine_top_fake_tokens_count</span><span class="p">)}</span>
<span class="n">word_cloud_not_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">count</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_not_fake_tokens_count</span><span class="p">,</span> <span class="n">freq_genuine_top_not_fake_tokens_count</span><span class="p">)}</span>
<span class="n">wordcloud_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_fake_data</span><span class="p">)</span>
<span class="n">wordcloud_not_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_not_fake_data</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_not_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1"># Hide axis</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Word Cloud based on frequencies&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.66</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/60fe75eeb7d5609f66920504339f2e71649b233b3133c8b15134fa8621f1fe69.png" src="_images/60fe75eeb7d5609f66920504339f2e71649b233b3133c8b15134fa8621f1fe69.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Interpretation</strong></p>
<ul>
<li><p>The left plot shows that the most prominent words are “Obama,” “Clinton,” “Donald,” “media,” “twitter,” and “news.” This suggests that these terms are most frequently used in fake news. The names suggest a focus on political figures during the period, which aligns with the 2016 US presidential election. The presence of “media” and “twitter” implies these platforms might be significant in the spread or discussion of fake news.</p></li>
<li><p>The right plot displays words like “government,” “Reuters,” “election,” “house,” and “Washington.” These terms are generally more formal and institutional than those in the fake news cloud. The prominence of “Reuters,” a well-known international news organization, suggests a source for genuine news. The words here are more associated with official government entities and political processes.</p></li>
</ul>
</li>
</ul>
<p>From these word clouds, we can infer that fake news articles might be more likely to mention high-profile personalities and social media, while genuine news articles are more likely to mention institutional and government-related terms</p>
</section>
<section id="odds-ratio">
<h2><strong>Odds Ratio</strong><a class="headerlink" href="#odds-ratio" title="Link to this heading">#</a></h2>
<p>We are interested in studying which words are used in a more differentiated way in each type of news (fake / not fake), that is, words that are used a lot in fake news and little in not Fake news, and vice versa.</p>
<p>One way to do this analysis is through the odds ratio of the frequencies.</p>
<div class="math notranslate nohighlight">
\[OR_{(1,0)}(t) \hspace{0.05cm}=\hspace{0.05cm}  \dfrac{P_1(t)}{P_0(t)} \hspace{0.05cm}=\hspace{0.05cm} \dfrac{\hspace{0.35cm} \dfrac{\hspace{0.15cm}n_1(t) + 1\hspace{0.15cm}}{N_1 + 1} \hspace{0.35cm}}{ \dfrac{\hspace{0.15cm} n_0(t) + 1 \hspace{0.15cm}}{N_0 +1}}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P_1(t)\)</span> is the proportion of times that the token <span class="math notranslate nohighlight">\(t\)</span> appear in the Fake news (1).</p></li>
<li><p><span class="math notranslate nohighlight">\(P_0(t)\)</span> is the proportion of times that the token <span class="math notranslate nohighlight">\(t\)</span> appear in the not Fake news (0).</p></li>
<li><p><span class="math notranslate nohighlight">\(n_1(t)\)</span> the number of times the token <span class="math notranslate nohighlight">\(t\)</span> appears in the fake news.</p></li>
<li><p><span class="math notranslate nohighlight">\(n_0(t)\)</span> the number of times the token <span class="math notranslate nohighlight">\(t\)</span> appears in the not fake news</p></li>
<li><p><span class="math notranslate nohighlight">\(N_1\)</span> is the number of terms (tokens, counting repetitions) that appear in the fake news</p></li>
<li><p><span class="math notranslate nohighlight">\(N_0\)</span> is the number of terms (tokens, counting repetitions) that appear in the not fake news</p></li>
</ul>
<p><strong>Observation:</strong></p>
<div class="math notranslate nohighlight">
\[OR_{(0,1)}(t) \hspace{0.05cm}=\hspace{0.05cm} \dfrac{1}{\hspace{0.12cm} OR_{(1,0)}(t) \hspace{0.12cm}}\]</div>
<section id="top-tokens-per-news-type-based-on-odds-ratio">
<h3><strong>Top tokens per news type based on Odds Ratio</strong><a class="headerlink" href="#top-tokens-per-news-type-based-on-odds-ratio" title="Link to this heading">#</a></h3>
<p>We compute the odds ratio of fake against not fake and vice versa, then, we plot the top 15 tokens according to the odds ratio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># vectorized n parameter</span>
<span class="k">def</span> <span class="nf">n</span><span class="p">(</span><span class="n">fake</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tokens_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">fake</span><span class="p">)[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="n">fake</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">())</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">fake</span><span class="p">)[</span><span class="s1">&#39;tokens&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">odds_fake_notfake</span> <span class="o">=</span> <span class="p">((</span><span class="n">n</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">n</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">odds_notfake_fake</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">odds_fake_notfake</span><span class="p">)</span>

<span class="n">top_fake_tokens_odds</span> <span class="o">=</span> <span class="n">unique_tokens</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">odds_fake_notfake</span><span class="p">)]</span>
<span class="n">top_not_fake_tokens_odds</span> <span class="o">=</span> <span class="n">unique_tokens</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">odds_notfake_fake</span><span class="p">)]</span>

<span class="n">odds_fake_notfake_sorted</span> <span class="o">=</span> <span class="n">odds_fake_notfake</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">odds_fake_notfake</span><span class="p">)]</span>
<span class="n">odds_notfake_fake_sorted</span> <span class="o">=</span> <span class="n">odds_notfake_fake</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">odds_notfake_fake</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Barplots for top tokens</strong></p>
<p>Plotting the top 15 tokens in the fake and not fake news, based on odds ratio, as a barplot.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_top</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">top_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">odds_fake_notfake_sorted</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">top_not_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">odds_notfake_fake_sorted</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tokens&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Top </span><span class="si">{</span><span class="n">n_top</span><span class="si">}</span><span class="s1"> tokens based on odds ratio&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/67cf8745efa64eaf1856df5d2767c1f6ed5eaec5e9043514741cb1d21b7d37da.png" src="_images/67cf8745efa64eaf1856df5d2767c1f6ed5eaec5e9043514741cb1d21b7d37da.png" />
</div>
</div>
<ul class="simple">
<li><p>Computing the <strong>genuine</strong> fake and not fake tokens, namely, tokens that are in the top-15 fake tokens but not in the top-15 not fake tokens, and vice versa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genuine_top_fake_tokens_odds_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>
<span class="n">genuine_top_not_fake_tokens_odds_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>

<span class="n">genuine_top_fake_tokens_odds</span> <span class="o">=</span> <span class="n">top_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_odds_idx</span><span class="p">]</span>
<span class="n">odds_genuine_top_fake_tokens</span> <span class="o">=</span> <span class="n">odds_fake_notfake_sorted</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_odds_idx</span><span class="p">]</span>

<span class="n">genuine_top_not_fake_tokens_odds</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_odds</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_odds_idx</span><span class="p">]</span>
<span class="n">freq_genuine_top_not_fake_tokens_odds</span> <span class="o">=</span> <span class="n">odds_notfake_fake_sorted</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_odds_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_cloud_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">odds</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_fake_tokens_odds</span><span class="p">,</span> <span class="n">odds_genuine_top_fake_tokens</span><span class="p">)}</span>
<span class="n">word_cloud_not_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">odds</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_not_fake_tokens_odds</span><span class="p">,</span> <span class="n">freq_genuine_top_not_fake_tokens_odds</span><span class="p">)}</span>
<span class="n">wordcloud_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_fake_data</span><span class="p">)</span>
<span class="n">wordcloud_not_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_not_fake_data</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_not_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1"># Hide axis</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Word Cloud based on odds ratio&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.68</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e6b3682e0a9c1f4298f073c6a7e8d80d7d5c2c3f9c6b8f34fa7f02705289c5be.png" src="_images/e6b3682e0a9c1f4298f073c6a7e8d80d7d5c2c3f9c6b8f34fa7f02705289c5be.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Interpretation</strong></p>
<ul>
<li><p>The most important words in fake news according with the odds ratio are “finicum,” “cum,” “philosophers,” “boiler,” “uninterruptible,” and “wikimedia.” The presence of such terms could indicate specific topics, narratives, or sources that are more commonly found in fake news. It’s worth noting that some of these words seem unusual or out of context in political news, which might suggest that fake news includes unexpected or less relevant content.</p></li>
<li><p>The left word cloud includes words like “Obama’s,” “Trump’s,” “party,” “Russia’s,” “China’s,” “president’s,” and “state’s.” These terms are more clearly associated with official political discourse and international relations. The presence of possessive forms of country names and leader’s names indicates that genuine news may focus more on specific actions or policies attributed to these entities or individuals.</p></li>
</ul>
</li>
</ul>
<p>The analysis suggests that fake news may focus on sensational or less authoritative topics, while genuine news is more likely to cover official and international matters, with a focus on specific figures and state actions.</p>
</section>
</section>
<section id="term-frequecy-inverse-document-frequency">
<h2><strong>Term Frequecy - Inverse Document Frequency</strong><a class="headerlink" href="#term-frequecy-inverse-document-frequency" title="Link to this heading">#</a></h2>
<p>One of the main interests in text mining, natural language processing and information retrieval is to quantify the subject matter of a text, as well as the importance of each term in it. A simple way to measure the importance of a term within a document is to use the frequency with which it appears (tf, term-frequency). This approach, although simple, has the limitation of attributing a lot of importance to those words that appear many times even though they do not provide selective information.</p>
<p>For example, if the word ‘mathematics’ appears 5 times in a document and the word ‘page’ appears 50 times, the second word will have 10 times more weight even though it does not provide as much information on the subject of the document.</p>
<p>To solve this problem, the tf values can be weighted by multiplying them by the inverse of the frequency with which the term in question appears in the rest of the documents (idf). In this way, it is possible to reduce the value of those terms that appear in many documents and therefore do not provide selective information.</p>
<p>The tf-idf statistic measures how informative a term is in a document by taking into account the frequency with which that term appears in other documents.</p>
<p><strong>Term Frequency</strong></p>
<div class="math notranslate nohighlight">
\[TF (t, d)= \dfrac{\hspace{0.2cm} n_d(t) \hspace{0.2cm}}{len(d)}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n_d(t)\)</span> is the number of times that the token <span class="math notranslate nohighlight">\(t\)</span> appears in the document <span class="math notranslate nohighlight">\(d\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(len(d)\)</span> is the length of the document <span class="math notranslate nohighlight">\(d\)</span>, that is, the number of tokens that it contains (considering repetitions).</p></li>
<li><p><span class="math notranslate nohighlight">\(TF (t, d)\)</span> is the frequency of the toke <span class="math notranslate nohighlight">\(t\)</span> in the document <span class="math notranslate nohighlight">\(d\)</span>.</p></li>
</ul>
<p><strong>Inverse Document Frequency</strong></p>
<div class="math notranslate nohighlight">
\[IDF (t) = log\left( \dfrac{N+1}{N(t)+1} \right) + 1\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N\)</span> is the total number of documents.</p></li>
<li><p><span class="math notranslate nohighlight">\(N(t)\)</span> is the total number of documents that contain the <span class="math notranslate nohighlight">\(t\)</span> token.</p></li>
<li><p>If a token <span class="math notranslate nohighlight">\(t\)</span> is contained by all the documents of the corpus, then <span class="math notranslate nohighlight">\(IDF(t) = 1\)</span></p></li>
<li><p>The lower documents containing a token <span class="math notranslate nohighlight">\(t\)</span>, the greater <span class="math notranslate nohighlight">\(\dfrac{N+1}{N(t)+1}\)</span>, and, therefore, the greater <span class="math notranslate nohighlight">\(IDF(t)\)</span></p></li>
</ul>
<p><strong>TF-IDF statistics</strong></p>
<div class="math notranslate nohighlight">
\[TFIDF(t, d) = TF (t, d) \cdot IDF (t)\]</div>
<p><strong>Observation</strong></p>
<ul class="simple">
<li><p>The greater <span class="math notranslate nohighlight">\(TFIDF(t,d)\)</span>, the more informative is the token <span class="math notranslate nohighlight">\(t\)</span> within the document <span class="math notranslate nohighlight">\(d\)</span>, and vice versa.</p></li>
<li><p><span class="math notranslate nohighlight">\(IDF(t)\)</span> is the weight given to <span class="math notranslate nohighlight">\(TF(t,d)\)</span> in  <span class="math notranslate nohighlight">\(TFIDF(t, d)\)</span>.</p></li>
<li><p>If a token <span class="math notranslate nohighlight">\(t\)</span> is present in many documents of the corpus, then <span class="math notranslate nohighlight">\(IDF(t)\)</span> will be small, and, therefore, the weight given to <span class="math notranslate nohighlight">\(TF(t,d)\)</span> in <span class="math notranslate nohighlight">\(TFIDF(t, d)\)</span> will be small.</p></li>
<li><p>If a token <span class="math notranslate nohighlight">\(t\)</span> is present in only a few documents of the corpus, then <span class="math notranslate nohighlight">\(IDF(t)\)</span> will be high, and, therefore, the weight given to <span class="math notranslate nohighlight">\(TF(t,d)\)</span> in <span class="math notranslate nohighlight">\(TFIDF(t, d)\)</span> will be high.</p></li>
<li><p>If the token <span class="math notranslate nohighlight">\(t\)</span> is very frequent in the document <span class="math notranslate nohighlight">\(d\)</span> and is not contained in many other documents of the corpus, then, <span class="math notranslate nohighlight">\(TFIDF(t,d)\)</span> will be high, because <span class="math notranslate nohighlight">\(t\)</span> will be an informative token within <span class="math notranslate nohighlight">\(d\)</span>. But, if <span class="math notranslate nohighlight">\(t\)</span> is contained in many other documents, <span class="math notranslate nohighlight">\(TFIDF(t,d)\)</span> will be lower than before because the token is less informative within <span class="math notranslate nohighlight">\(d\)</span></p></li>
<li><p>If the token <span class="math notranslate nohighlight">\(t\)</span> is very frequent in the document <span class="math notranslate nohighlight">\(d\)</span> but is contain in many other documents of the corpus as well, then, <span class="math notranslate nohighlight">\(TFIDF(t,d)\)</span> will be lower t and it will be a significative token within <span class="math notranslate nohighlight">\(d\)</span>.</p></li>
</ul>
<p>This is a common term weighting scheme in information
retrieval, that has also found good use in document classification.
The goal of using tf-idf instead of the raw frequencies of occurrence of a
token in a given document is to scale down the impact of tokens that occur
very frequently in a given corpus and that are hence empirically less
informative than features that occur in a small fraction of the training
corpus.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">Sklearn</span></code> the formula that is used to compute the tf-idf for a term t of a document d
in a document set is <code class="docutils literal notranslate"><span class="pre">tf-idf(t,</span> <span class="pre">d)</span> <span class="pre">=</span> <span class="pre">tf(t,</span> <span class="pre">d)</span> <span class="pre">*</span> <span class="pre">idf(t)</span></code>, and the idf is
computed as <code class="docutils literal notranslate"><span class="pre">idf(t)</span> <span class="pre">=</span> <span class="pre">log</span> <span class="pre">[</span> <span class="pre">n</span> <span class="pre">/</span> <span class="pre">df(t)</span> <span class="pre">]</span> <span class="pre">+</span> <span class="pre">1</span></code> (if <code class="docutils literal notranslate"><span class="pre">smooth_idf=False</span></code>), where
n is the total number of documents in the document set and df(t) is the
document frequency of t; the document frequency is the number of documents
in the document set that contain the term t. The effect of adding “1” to
the idf in the equation above is that terms with zero idf, i.e., terms
that occur in all documents in a training set, will not be entirely
ignored.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">smooth_idf=True</span></code> (the default), the constant 1 is added to the
numerator and denominator of the idf as if an extra document was seen
containing every term in the collection exactly once, which prevents
zero divisions: <code class="docutils literal notranslate"><span class="pre">idf(t)</span> <span class="pre">=</span> <span class="pre">log</span> <span class="pre">[</span> <span class="pre">(1</span> <span class="pre">+</span> <span class="pre">n)</span> <span class="pre">/</span> <span class="pre">(1</span> <span class="pre">+</span> <span class="pre">df(t))</span> <span class="pre">]</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<section id="understanding-tf-idf-with-a-toy-example">
<h3><strong>Understanding TF-IDF with a toy example</strong><a class="headerlink" href="#understanding-tf-idf-with-a-toy-example" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>A toy example to understand how TF-IDF works</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_tokens_toy</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">tokens_toy</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;token</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_tokens_toy</span><span class="p">)]</span>

<span class="c1"># Number of times that the token t appears in the document d</span>
<span class="n">ndt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="c1"># length of the document d</span>
<span class="n">len_d</span> <span class="o">=</span> <span class="mi">650</span>
<span class="c1"># Number of documents</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="c1"># Number of documents that contain the token t</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">TF_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">/</span><span class="n">len_d</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ndt</span><span class="p">])</span>
<span class="n">IDF_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Nt</span><span class="p">])</span>
<span class="n">TFIDF_values</span> <span class="o">=</span> <span class="n">TF_values</span> <span class="o">*</span> <span class="n">IDF_values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cols</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ndt</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tokens_toy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">ndt</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">tokens_toy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Nt</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tokens_toy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Nt</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">tokens_toy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">TF_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tokens_toy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">TF_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">tokens_toy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">IDF_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tokens_toy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">IDF_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">tokens_toy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">TFIDF_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tokens_toy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>  <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">TFIDF_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">tokens_toy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ndt</span><span class="p">)]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$n_d(t)$&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$N_t$&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TF&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;IDF&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TF-IDF&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$n_d(t)$ $vs$ tokens&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$N_t$ $vs$ tokens&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;TF $vs$ tokens&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;IDF $vs$ tokens&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;TF-IDF $vs$ tokens&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tokens&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mf">9.5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;TF-IDF of tokens in a given document (d)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.18</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2ee30440e24a3d6052bc47c818dbfd491e0882986212f96b9140c02bfb4f537d.png" src="_images/2ee30440e24a3d6052bc47c818dbfd491e0882986212f96b9140c02bfb4f537d.png" />
</div>
</div>
</section>
<section id="computing-tf-idf">
<h3><strong>Computing TF-IDF</strong><a class="headerlink" href="#computing-tf-idf" title="Link to this heading">#</a></h3>
<p>We compute the TF-IDF statistics for our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing TF for our data-set</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tokens_explode_df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;text_id&#39;</span><span class="p">,</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Fake&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;nd(t)&#39;</span><span class="p">))</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;text_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;nd(t)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;len(d)&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;text_id&#39;</span><span class="p">)</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;text_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">tf_df</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;nd(t)&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;len(d)&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;TF&#39;</span><span class="p">))</span>

<span class="c1"># Computing IDF for our data-set</span>
<span class="n">df4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;tokens&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;text_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n_unique</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;N(t)&#39;</span><span class="p">))</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">news_df</span><span class="p">)</span>
<span class="n">idf_df</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;N(t)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;IDF&#39;</span><span class="p">))</span> <span class="c1"># sklearn formula</span>

<span class="c1"># Computing TF-IDF for our data-set</span>
<span class="n">tf_idf_df</span> <span class="o">=</span> <span class="n">tf_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">idf_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">tf_idf_df</span> <span class="o">=</span> <span class="n">tf_idf_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;TF&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;IDF&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The next table contains not only the TF-IDF of the tokens of each news, but also the different quantities that define the TF-IDF, for a better understanding of how this statistics behaves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tf_idf_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 9)</small><table border="1" class="dataframe"><thead><tr><th>text_id</th><th>tokens</th><th>Fake</th><th>nd(t)</th><th>len(d)</th><th>TF</th><th>N(t)</th><th>IDF</th><th>TF_IDF</th></tr><tr><td>i32</td><td>str</td><td>i32</td><td>u32</td><td>u32</td><td>f64</td><td>u32</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0</td><td>&quot;media&quot;</td><td>1</td><td>3</td><td>250</td><td>0.012</td><td>8097</td><td>2.712798</td><td>0.032554</td></tr><tr><td>0</td><td>&quot;reality&quot;</td><td>1</td><td>1</td><td>250</td><td>0.004</td><td>1978</td><td>4.121824</td><td>0.016487</td></tr><tr><td>0</td><td>&quot;supporters&quot;</td><td>1</td><td>2</td><td>250</td><td>0.008</td><td>3845</td><td>3.457382</td><td>0.027659</td></tr><tr><td>0</td><td>&quot;december&quot;</td><td>1</td><td>13</td><td>250</td><td>0.052</td><td>2124</td><td>4.050644</td><td>0.210633</td></tr><tr><td>0</td><td>&quot;tweet&quot;</td><td>1</td><td>2</td><td>250</td><td>0.008</td><td>1952</td><td>4.135049</td><td>0.03308</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="top-tokens-per-news-type-based-on-tf-idf">
<h3><strong>Top tokens per news type based on TF-IDF</strong><a class="headerlink" href="#top-tokens-per-news-type-based-on-tf-idf" title="Link to this heading">#</a></h3>
<section id="using-our-tf-idf-values">
<h4><strong>Using our TF-IDF values</strong><a class="headerlink" href="#using-our-tf-idf-values" title="Link to this heading">#</a></h4>
<p>We compute the most frequent tokens depending on the news type, then we plot the top tokens in both groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_df</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1"># For only taking into account tokens that appear at least in the 5 % of the documents</span>
<span class="n">top_fake_tokens_tfidf_df</span> <span class="o">=</span> <span class="n">tf_idf_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;N(t)&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_df</span><span class="o">*</span><span class="n">n_news</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Fake&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">top_not_fake_tokens_tfidf_df</span> <span class="o">=</span> <span class="n">tf_idf_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;N(t)&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">min_df</span><span class="o">*</span><span class="n">n_news</span><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;Fake&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;Fake&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">top_fake_tokens_tfidf_values</span> <span class="o">=</span> <span class="n">top_fake_tokens_tfidf_df</span><span class="p">[</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">top_fake_tokens_tfidf</span> <span class="o">=</span> <span class="n">top_fake_tokens_tfidf_df</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">top_not_fake_tokens_tfidf_values</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_tfidf_df</span><span class="p">[</span><span class="s1">&#39;TF_IDF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">top_not_fake_tokens_tfidf</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_tfidf_df</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Barplots for top tokens</strong></p>
<p>Plotting the top 15 tokens in the fake and not fake news, based on frequencies, as a barplot.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_top</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">top_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">top_fake_tokens_tfidf_values</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">top_not_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">top_not_fake_tokens_tfidf_values</span><span class="p">[:</span><span class="n">n_top</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tokens&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Top </span><span class="si">{</span><span class="n">n_top</span><span class="si">}</span><span class="s1"> tokens based on TF-IDF&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.55</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c654b9cfb29231f387a33679de5c94d2a5af5a65ad69787a6ec0c7e90799e71b.png" src="_images/c654b9cfb29231f387a33679de5c94d2a5af5a65ad69787a6ec0c7e90799e71b.png" />
</div>
</div>
<ul class="simple">
<li><p>Computing the <strong>genuine</strong> fake and not fake tokens, namely, tokens that are in the top-15 fake tokens but not in the top-15 not fake tokens, and vice versa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genuine_top_fake_tokens_tfidf_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>
<span class="n">genuine_top_not_fake_tokens_tfidf_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">top_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top_not_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">]])</span>

<span class="n">genuine_top_fake_tokens_tfidf</span> <span class="o">=</span> <span class="n">top_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_tfidf_idx</span><span class="p">]</span>
<span class="n">genuine_top_fake_tokens_tfidf_values</span> <span class="o">=</span> <span class="n">top_fake_tokens_tfidf_values</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_fake_tokens_tfidf_idx</span><span class="p">]</span>

<span class="n">genuine_top_not_fake_tokens_tfidf</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_tfidf</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_tfidf_idx</span><span class="p">]</span>
<span class="n">genuine_top_not_fake_tokens_tfidf_values</span> <span class="o">=</span> <span class="n">top_not_fake_tokens_tfidf_values</span><span class="p">[:</span><span class="n">n_top</span><span class="p">][</span><span class="n">genuine_top_not_fake_tokens_tfidf_idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Word clouds for genuine top tokens</strong></p>
<p>Plotting the top genuine tokens in the fake and not fake news as a word cloud.</p>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">word_cloud_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">tfidf</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">tfidf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_fake_tokens_tfidf</span><span class="p">,</span> <span class="n">genuine_top_fake_tokens_tfidf_values</span><span class="p">)}</span>
<span class="n">word_cloud_not_fake_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">token</span><span class="p">:</span> <span class="n">tfidf</span> <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">tfidf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">genuine_top_not_fake_tokens_tfidf</span><span class="p">,</span> <span class="n">genuine_top_not_fake_tokens_tfidf_values</span><span class="p">)}</span>
<span class="n">wordcloud_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_fake_data</span><span class="p">)</span>
<span class="n">wordcloud_not_fake</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_cloud_not_fake_data</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud_not_fake</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="c1"># Hide axis</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Word Cloud based on odds ratio&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.68</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2217ae5b560e39ae2d18d9fb36bf9ca9f648e29667b6f0967a10f401dd20e49a.png" src="_images/2217ae5b560e39ae2d18d9fb36bf9ca9f648e29667b6f0967a10f401dd20e49a.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Interpretation</strong></p>
<ul>
<li><p>In this fake news word cloud the most prominent words are “Clinton,” “Trump,” “CNN,” “judge,” “black,” “school,” “fox,” and “women.” These words suggest that fake news articles might focus heavily on key figures and organizations involved in the American political scene, possibly framing narratives around them in a way that is not as common in genuine news sources.</p></li>
<li><p>This not fake word cloud highlights words like “China,” “Russian,” “nuclear,” “Islamic,” “European,” “court,” and “bill.” The prominence of these terms indicates that genuine news might focus more on international relations, legal matters, and significant policy or security issues. These topics are more specialized and may require more in-depth reporting and analysis, which could explain their importance in the TF-IDF metric for not fake news.</p></li>
</ul>
</li>
</ul>
<p>Together, these clouds suggest that fake news may tend towards sensationalizing political figures and entities, potentially to attract attention or manipulate opinion, while genuine news appears to address broader international and policy-related topics, which might be less sensational but are significant to an informed public.</p>
</section>
</section>
</section>
<section id="news-classification">
<h2><strong>News Classification</strong><a class="headerlink" href="#news-classification" title="Link to this heading">#</a></h2>
<p>In this section we are going to develop several steps related with the classification of the news in fake and not fake.</p>
<p>The classifiers that we are going to use in this project are the following:</p>
<ul class="simple">
<li><p>Naive TF-IDF</p></li>
<li><p>KNN</p></li>
<li><p>Gaussian Naive</p></li>
<li><p>Multinomial Naive Bayes</p></li>
<li><p>Complement Multinomial Naive Bayes</p></li>
<li><p>Bernoulli Naive Bayes</p></li>
</ul>
<p>In this section we are going to explain them.</p>
<section id="naive-bayes-classifiers">
<h3><strong>Naive Bayes Classifiers</strong><a class="headerlink" href="#naive-bayes-classifiers" title="Link to this heading">#</a></h3>
<p>Along this section assume that we have data for a categorical response <span class="math notranslate nohighlight">\(Y=(y_1,\dots , y_n)^\prime \in \mathbb{R}^n\)</span> with <span class="math notranslate nohighlight">\(k\)</span> categories <span class="math notranslate nohighlight">\(\mathcal{D}(Y)=\lbrace 0, 1,\dots, k-1 \rbrace\)</span>, and for <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(X=(X_1, \dots, X_p)\in \mathbb{R}^{n\times p}\)</span>, where <span class="math notranslate nohighlight">\(X_j=(x_{1j}, \dots, x_{nj})^\prime\)</span> is the vector with the <span class="math notranslate nohighlight">\(n\)</span> observations of the <span class="math notranslate nohighlight">\(j\)</span>-th predictor and <span class="math notranslate nohighlight">\(x_i = (x_{i1}, \dots, x_{ip})^\prime\)</span> is the vector with the values of the predictors for the <span class="math notranslate nohighlight">\(i\)</span>-th observation.</p>
<p>Applying the Bayes theorem we have the following:</p>
<div class="math notranslate nohighlight">
\[P(Y=y_i | X=x_i) = \dfrac{\hspace{0.1cm} P(X=x_i | Y=y_i)\cdot P(Y=y_i)\hspace{0.1cm}}{P(X=x_i)}\]</div>
<p><strong>Naive assumption:</strong> the predictors are independent <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm} \)</span> <span class="math notranslate nohighlight">\(X_j \perp X_r \quad \forall j\neq r\)</span></p>
<p>Under this assumption:</p>
<div class="math notranslate nohighlight">
\[P(X=x_i | Y=y_i) = P(X_1=x_{i1}, \dots, X_p=x_{ip} | Y=y_i) = \prod_{j=1}^p P(X_j = x_{ij} | Y=y_i)\]</div>
<p>Therefore, the Bayes theorem could be transform as:</p>
<div class="math notranslate nohighlight">
\[P(Y=y_i | X=x_i) = \dfrac{\prod_{j=1}^p P(X_j = x_{ij} | Y=y_i)\cdot P(Y=y_i)}{P(X=x_i)} \propto \prod_{j=1}^p P(X_j = x_{ij} | Y=y_i)\cdot P(Y=y_i)\]</div>
<p>The prediction criteria in Naive Bayes classifiers consist of classify in the response class with more probability given the predictors data.</p>
<p>Given a new observation of the predictors <span class="math notranslate nohighlight">\(x_* = (x_{*1}, \dots , x_{*p})^\prime\)</span>, the response for it is predicted as follows:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_* = arg \underset{c \in \mathcal{D}(Y)}{Max} \widehat{P}(Y=c | X=x_*) = arg \underset{c \in \mathcal{D}(Y)}{Max}  \prod_{j=1}^p \widehat{P}(X_j = x_{*j} | Y=c)\cdot \widehat{P}(Y=c)\]</div>
<p><strong>How to estimate the involved probabilities?</strong></p>
<ul>
<li><p><span class="math notranslate nohighlight">\(P(Y=c)\)</span> is estimated as the relative frequency of the response class <span class="math notranslate nohighlight">\(c\)</span> in the training set.</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(Y=c) = \dfrac{\# \lbrace i=1,\dots n : y_i = c\rbrace}{n}\]</div>
</li>
<li><p>The problematic point arises with the estimation of <span class="math notranslate nohighlight">\(P(X_j = x_{*j} | Y=c)\)</span>.</p>
<p>The very naive option would be:</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(X_j = x_{*j} | Y=c) = \dfrac{\# \lbrace i=1,\dots,n : x_{ij} = x_{*j} \hspace{0.1cm};\hspace{0.1cm} y_i = c\rbrace }{\# \lbrace i=1,\dots,n : y_i = c\rbrace }\]</div>
<p>The problem with this approach is that <span class="math notranslate nohighlight">\(\widehat{P}(X_j = x_{*j} | Y=c) =0\)</span> for some predictor <span class="math notranslate nohighlight">\(j=1,\dots , p\)</span> is a common scenario for any category <span class="math notranslate nohighlight">\(c\)</span> of the response, specially whe we have predictors that are not strictly categorical, which is typical, specially in text classification where TF-IDF an word counts are the dominant options. An the problem of that scenario is that leads to <span class="math notranslate nohighlight">\(P(Y=c  | X=x_*)=0\)</span> for any <span class="math notranslate nohighlight">\(c\)</span>, what means that the classification will be done by chance, which doesn’t make sense.</p>
<p>The avoid this problem, a probability distribution is assumed to estimate <span class="math notranslate nohighlight">\(P(X_j = x_{*j} | Y=c)\)</span>, and depending of the chosen distribution we have one naive Bayes or another.</p>
</li>
</ul>
</section>
<section id="gaussian-naive-bayes">
<h3><strong>Gaussian Naive Bayes</strong><a class="headerlink" href="#gaussian-naive-bayes" title="Link to this heading">#</a></h3>
<p>Assumes that:</p>
<div class="math notranslate nohighlight">
\[X_j = x_{*j} | Y=c \hspace{0.1cm}\sim\hspace{0.1cm} N(\mu_{j,c}, \sigma^2_{j,c})\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mu_{j,c} = \dfrac{1}{n_c} \cdot \sum_{\substack{i=1 \\ y_i=c}}^n x_{ij}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\sigma^2_{j,c} = \dfrac{1}{n_c} \cdot \sum_{\substack{i=1 \\ y_i=c}}^n (x_{ij} - \mu_{j,c})^2\end{split}\]</div>
<p>is the mean and variance, respectively, of <span class="math notranslate nohighlight">\(X_j\)</span> for the train observations of the group <span class="math notranslate nohighlight">\(Y=c\)</span>.</p>
<p>Therefore:</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(X_j = x_{*j} | Y=c) = \int_{x_{*j}-\varepsilon}^{x_{*j}+\varepsilon} f_{N(\mu_{j,c}, \sigma^2_{j,c})}(x) dx \hspace{0.15cm} &gt; \hspace{0.15cm} 0\quad\quad \varepsilon \rightarrow 0\]</div>
<p>This model is suitable when the predictors are continuous, like in the TF-IDF case.</p>
</section>
<section id="multinomial-naive-bayes">
<h3><strong>Multinomial Naive Bayes</strong><a class="headerlink" href="#multinomial-naive-bayes" title="Link to this heading">#</a></h3>
<p>This model is specially thought for text classification.</p>
<p>This model assumes that:</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(X_j = x_{*j} | Y=c)  = \widehat{p}_{j,c}^{\hspace{0.1cm} x_{*j}}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\widehat{p}_{j,c} = \dfrac{n(t_j,c) + \alpha}{n_c + \alpha \cdot n}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}n(t_j,c)= \sum_{\substack{i=1 \\ y_i=c}}^n f(t_j, d_i)\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}n_c = \sum_{\substack{i=1 \\ y_i=c}}^n len(d_i)\end{split}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widehat{p}_{j,c}\)</span> is the training estimation of <span class="math notranslate nohighlight">\(P(t_j | Y=c)\)</span>, that is the probability of token <span class="math notranslate nohighlight">\(t_j\)</span> is  in the group <span class="math notranslate nohighlight">\(Y=c\)</span>, namely, the relative frequency of the token <span class="math notranslate nohighlight">\(t_j\)</span> in each document of the class <span class="math notranslate nohighlight">\(Y=c\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(n(t_j,c)\)</span> is the frequency of the token <span class="math notranslate nohighlight">\(t_j\)</span> in the training documents of the group <span class="math notranslate nohighlight">\(Y=c\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(n_c\)</span> is the number of training documents of the class <span class="math notranslate nohighlight">\(Y=c\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(f(t_j, d_i)\)</span> is the frequency of the token <span class="math notranslate nohighlight">\(t_j\)</span> in the document <span class="math notranslate nohighlight">\(d_i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(len(d_i)\)</span> is the number of tokens of the document <span class="math notranslate nohighlight">\(d_i\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha \geq 0\)</span> accounts for tokens not present in the learning samples and prevents zero probabilities in further computations. <span class="math notranslate nohighlight">\(\alpha = 1\)</span>  is called Laplace smoothing, while <span class="math notranslate nohighlight">\(\alpha &lt; 1\)</span> is called Lidstone smoothing.</p></li>
</ul>
<p>This model is more suitable for discrete predictors (specially counting data), like word counts predictors, but it also usually works well with TF-IDF.</p>
</section>
<section id="bernoulli-naive-bayes">
<h3><strong>Bernoulli Naive Bayes</strong><a class="headerlink" href="#bernoulli-naive-bayes" title="Link to this heading">#</a></h3>
<p>This model is thought for text classification, as the previous one.</p>
<p>This model assumes that:</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(X_j = x_{*j} | Y=c)  = \widehat{p}_{j,c}^{\hspace{0.1cm} x_{*j}}\cdot (1- \widehat{p}_{j,c})^{1-x_{*j}} \quad x_{*j} \in \lbrace 0 , 1 \rbrace\]</div>
<p>This model is for dummy predictors, that could indicate wether the token appears or not in the document.</p>
<p>If the predictors are TF-IDF or word counts, the algorithm forces them to belong to <span class="math notranslate nohighlight">\(\lbrace 0 , 1 \rbrace\)</span> using, for example, <code class="docutils literal notranslate"><span class="pre">MinMaxScaler(0,1)</span></code> and after that rounding the resulting values.</p>
</section>
<section id="categorical-naive-bayes">
<h3><strong>Categorical Naive Bayes</strong><a class="headerlink" href="#categorical-naive-bayes" title="Link to this heading">#</a></h3>
<p>This model assumes that the predictors are categorical variables and</p>
<div class="math notranslate nohighlight">
\[\widehat{P}(X_j = x_{*j} | Y=c) = \dfrac{n(x_{*j},c) + \alpha}{n_c + \alpha\cdot h_j}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n(x_{*j},c)\)</span> is the number of documents of the class <span class="math notranslate nohighlight">\(Y=c\)</span> that has the category <span class="math notranslate nohighlight">\(X_j = x_{*j}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(h_j = \#\mathcal{D}(X_j)\)</span> is the number of unique categories of <span class="math notranslate nohighlight">\(X_j\)</span>.</p></li>
</ul>
<p>This model can be used to classify individuals based on categorical predictors.</p>
</section>
<section id="complement-naive-bayes">
<h3><strong>Complement Naive Bayes</strong><a class="headerlink" href="#complement-naive-bayes" title="Link to this heading">#</a></h3>
<p>Is a modification of Multinomial Naive Bayes, specially designed for imbalanced classification problems.</p>
</section>
<section id="tf-idf-naive-classifier">
<h3><strong>TF-IDF Naive Classifier</strong><a class="headerlink" href="#tf-idf-naive-classifier" title="Link to this heading">#</a></h3>
<p><span class="math notranslate nohighlight">\(\text{Top}_{train}(k_1 | Y= c) =\)</span> indices of the top <span class="math notranslate nohighlight">\(k_1\)</span> (<code class="docutils literal notranslate"><span class="pre">n_top_train</span></code>) tokens in the training documents of the class <span class="math notranslate nohighlight">\(Y=c\)</span>, according to their  TF-IDF <em>average</em> values.</p>
<p><span class="math notranslate nohighlight">\(\text{Top}_{new}(k_2, i) = \)</span> indices of the top <span class="math notranslate nohighlight">\(k_2\)</span> (<code class="docutils literal notranslate"><span class="pre">n_top_new</span></code>) tokens in the (new) document <span class="math notranslate nohighlight">\(i\)</span>, according to their TF-IDF values.</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i = arg \hspace{0.1cm}\underset{c \in \mathcal{D}(Y)}{Max} \hspace{0.1cm}\text{PropMatches}(\text{Top}_{new}(k_2, i), \text{Top}_{train}(k_1| Y= c))\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{PropMatches}(\text{Top}_{new}(k_2, i), \text{Top}_{train}(k_1| Y= c))\)</span> is the proportion of top tokens of the document <span class="math notranslate nohighlight">\(i\)</span> that are top tokens of class <span class="math notranslate nohighlight">\(Y=c\)</span> as well, that is, proportion of matches between the top tokens of document <span class="math notranslate nohighlight">\(i\)</span> and top tokens of class <span class="math notranslate nohighlight">\(Y=c\)</span>.</p></li>
</ul>
<p>If the document <span class="math notranslate nohighlight">\(i\)</span> has many (or at least enough) top tokens that are top tokens of class <span class="math notranslate nohighlight">\(Y=c\)</span> as well, then, it will be classify as class <span class="math notranslate nohighlight">\(c\)</span>.</p>
</section>
<section id="predictors-and-response-definition">
<h3><strong>Predictors and Response Definition</strong><a class="headerlink" href="#predictors-and-response-definition" title="Link to this heading">#</a></h3>
<p>Defining the predictors and the response, the outer-evaluation (train-test split) and the inner-evaluation (Kfold Cross Validation).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining the predictors and the response</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">news_df</span><span class="p">[</span><span class="s1">&#39;Fake&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="outer-inner-evaluation-definition">
<h3><strong>Outer-Inner Evaluation Definition</strong><a class="headerlink" href="#outer-inner-evaluation-definition" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining the outer-evaluation: train-test split.</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="c1"># Defining dictionaries to save the inner scores and best parameters of the models</span>
<span class="n">inner_scores</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="c1"># Defining the inner-evaluation: k-fold</span>
<span class="n">inner</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pipelines">
<h3><strong>Pipelines</strong><a class="headerlink" href="#pipelines" title="Link to this heading">#</a></h3>
<p>Defining the pipelines with the transformers and the classifiers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;naive_tfidf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;tfidf_vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;naive_tfidf&#39;</span><span class="p">,</span> <span class="n">Naive_TFIDF_Classifier</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;gnb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;tfidf_vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;sparsetodense&#39;</span><span class="p">,</span> <span class="n">SparseToDense</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;gnb&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;mnb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;tfidf_vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;mnb&#39;</span><span class="p">,</span> <span class="n">MultinomialNB</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;cmnb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;tfidf_vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;cmnb&#39;</span><span class="p">,</span> <span class="n">ComplementNB</span><span class="p">())</span> 
    <span class="p">])</span>

<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;tfidf_vectorizer&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;bnb&#39;</span><span class="p">,</span> <span class="n">BernoulliNB</span><span class="p">())</span> 
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameter-grids">
<h3><strong>Parameter Grids</strong><a class="headerlink" href="#parameter-grids" title="Link to this heading">#</a></h3>
<p>We define the parameter grids for all the pipelines, which will be used for HPO (hyperparameter optimization).</p>
<ul class="simple">
<li><p>Common grid for all the models.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;tfidf_vectorizer__smooth_idf&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;tfidf_vectorizer__smooth_idf&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]),</span>
        <span class="s1">&#39;tfidf_vectorizer__min_df&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;tfidf_vectorizer__min_df&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Grid for Naive TF-IDF classifier</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_naive_TFIDF</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;naive_tfidf__n_top_tokens_train&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;naive_tfidf__n_top_tokens_train&#39;</span><span class="p">,</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">]),</span>
        <span class="s1">&#39;naive_tfidf__n_top_tokens_test&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;naive_tfidf__n_top_tokens_test&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">]),</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Grid for Gaussian Naive Bayes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_GaussianNB</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Grid for Multinomial Naive Bayes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_MultinominalNB</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;mnb__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;mnb__alpha&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Grid for Complement Multinomial Naive Bayes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_ComplementMultinominalNB</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;cmnb__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;cmnb__alpha&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Grid for Bernoulli Naive Bayes</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">param_grid_BernoulliNB</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
    <span class="n">param_grid</span> <span class="o">=</span> <span class="n">common_param_grid</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>
    <span class="n">param_grid</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;bnb__alpha&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;bnb__alpha&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">param_grid</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hyper-parameter-optimization-hpo">
<h3><strong>Hyper-parameter Optimization (HPO)</strong><a class="headerlink" href="#hyper-parameter-optimization-hpo" title="Link to this heading">#</a></h3>
<section id="naive-tf-idf-classifier">
<h4><strong>Naive TF-IDF Classifier</strong><a class="headerlink" href="#naive-tf-idf-classifier" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_eval</span> <span class="o">=</span> <span class="n">SimpleEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;naive_tfidf&#39;</span><span class="p">],</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_naive_TFIDF</span><span class="p">,</span> 
                 <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">simple_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;TFIDF_Naive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_score</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;TFIDF_Naive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_best_params</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;TFIDF_Naive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_results</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="knn-classifier">
<h3><strong>KNN Classifier</strong><a class="headerlink" href="#knn-classifier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initializing the TfidfVectorizer.</span>
<span class="c1"># min_df=0.05 to include only the tokens that appear in at least 3 % documents</span>
<span class="n">tfidf_vect</span> <span class="o">=</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">min_df</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">stop_words</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span> <span class="n">smooth_idf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Fitting the TfidfVectorizer with the training data.</span>
<span class="n">tfidf_vect</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="c1"># Defining train and test TF-IDF spare matrices.</span>
<span class="n">X_train_tfidf_spare</span> <span class="o">=</span> <span class="n">tfidf_vect</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_tfidf_spare</span> <span class="o">=</span> <span class="n">tfidf_vect</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;KNN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">knn</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train_tfidf_spare</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">inner</span><span class="p">))</span> <span class="c1"># Time: 7.35 mins</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;KNN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="gaussian-naive-bayes-classifier">
<h3><strong>Gaussian Naive Bayes Classifier</strong><a class="headerlink" href="#gaussian-naive-bayes-classifier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_eval</span> <span class="o">=</span> <span class="n">SimpleEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;gnb&#39;</span><span class="p">],</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_GaussianNB</span><span class="p">,</span> 
                 <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">simple_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;Gaussian_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_score</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;Gaussian_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_best_params</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Gaussian_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multinomial-naive-bayes-classifier">
<h3><strong>Multinomial Naive Bayes Classifier</strong><a class="headerlink" href="#multinomial-naive-bayes-classifier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_eval</span> <span class="o">=</span> <span class="n">SimpleEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;mnb&#39;</span><span class="p">],</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_MultinominalNB</span><span class="p">,</span> 
                 <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">simple_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_score</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_best_params</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="complement-multinomial-naive-bayes-classifier">
<h3><strong>Complement Multinomial Naive Bayes Classifier</strong><a class="headerlink" href="#complement-multinomial-naive-bayes-classifier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_eval</span> <span class="o">=</span> <span class="n">SimpleEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;cmnb&#39;</span><span class="p">],</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_ComplementMultinominalNB</span><span class="p">,</span> 
                 <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">simple_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;Complement_Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_score</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;Complement_Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_best_params</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Complement_Multinomial_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="bernoulli-naive-bayes-classifier">
<h3><strong>Bernoulli Naive Bayes Classifier</strong><a class="headerlink" href="#bernoulli-naive-bayes-classifier" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple_eval</span> <span class="o">=</span> <span class="n">SimpleEvaluation</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">],</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_BernoulliNB</span><span class="p">,</span> 
                 <span class="n">inner</span><span class="o">=</span><span class="n">inner</span><span class="p">,</span> <span class="n">search_method</span><span class="o">=</span><span class="s1">&#39;optuna&#39;</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> 
                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">simple_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">inner_scores</span><span class="p">[</span><span class="s1">&#39;Bernoulli_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_score</span>
<span class="n">params</span><span class="p">[</span><span class="s1">&#39;Bernoulli_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_best_params</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Bernoulli_Naive_Bayes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_eval</span><span class="o">.</span><span class="n">inner_results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-selection">
<h3><strong>Model selection</strong><a class="headerlink" href="#model-selection" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Saving the results</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Saving the results as pickle files</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">with open(&#39;params&#39;, &#39;wb&#39;) as file:</span>
<span class="sd">    pickle.dump(params, file)</span>

<span class="sd">with open(&#39;inner_scores&#39;, &#39;wb&#39;) as file:</span>
<span class="sd">    pickle.dump(inner_scores, file)</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Opening the results</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;inner_scores&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">inner_scores</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">inner_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">inner_scores_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">inner_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">inner_scores_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">85</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">),</span> 
                     <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_model</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">12.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">inner_scores_values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The best model is&#39;</span><span class="p">,</span> <span class="n">best_model</span><span class="p">,</span>  <span class="s1">&#39;and its best parameters are&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">best_model</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/453e45163c421c4e6c14881202af2193002c32f2d970879a98bdefd95968c099.png" src="_images/453e45163c421c4e6c14881202af2193002c32f2d970879a98bdefd95968c099.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model is Bernoulli_Naive_Bayes and its best parameters are {&#39;tfidf_vectorizer__smooth_idf&#39;: True, &#39;tfidf_vectorizer__min_df&#39;: 0.2, &#39;bnb__alpha&#39;: 6.15}
</pre></div>
</div>
</div>
</div>
<ul>
<li><p><strong>Conclusions</strong></p>
<p>The Naive Bayes models performs pretty well in this case, specially the Bernoulli Naive Bayes, which is the best model according to the inner evaluation.</p>
<p>We can also see that the Laplace smoothing is important in this case, since the best <code class="docutils literal notranslate"><span class="pre">bnb_alpha</span></code> is far away from zero.</p>
</li>
</ul>
</section>
<section id="estimation-of-future-performance">
<h3>Estimation of future performance<a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h3>
<p>Estimation of future performance with the best model, that is the Bernoulli Naive Bayes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="n">best_model</span><span class="p">])</span> 
<span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">)</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">future_performance</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The estimated future performance for the best model is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">future_performance</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">, which is almost perfect!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The confusion matrix of the most model is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">display_labels</span><span class="o">=</span><span class="n">pipelines</span><span class="p">[</span><span class="s1">&#39;bnb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">values_format</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">,</span> <span class="n">text_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Confusion Matrix </span><span class="se">\n</span><span class="s1"> Fake News Classification&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted class&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True class&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7fc4f1f248fbfa67764a810c4f11928d8d0bac6588a681a3edf06c7aa660b2f8.png" src="_images/7fc4f1f248fbfa67764a810c4f11928d8d0bac6588a681a3edf06c7aa660b2f8.png" />
</div>
</div>
<ul class="simple">
<li><p>The confusion matrix shows that both classes are really well classified, but the not fake news are a bit better classified.</p></li>
</ul>
</section>
</section>
<section id="sentiment-analysis">
<h2><strong>Sentiment Analysis</strong><a class="headerlink" href="#sentiment-analysis" title="Link to this heading">#</a></h2>
<p>The compound polarity score, as computed by the SentimentIntensityAnalyzer (SIA) in NLTK, is a normalized score that represents the overall sentiment of a piece of text. It’s derived from the positive, negative, and neutral scores computed for the text.</p>
<ul class="simple">
<li><p>Positive Score: The positive score represents the proportion of words in the text that are classified as positive. It’s computed by counting the occurrences of positive words and normalizing it by the total number of words in the text.</p></li>
<li><p>Negative Score: Similar to the positive score, the negative score represents the proportion of words classified as negative. It’s computed by counting the occurrences of negative words and normalizing it by the total number of words in the text.</p></li>
<li><p>Neutral Score: The neutral score represents the proportion of words classified as neutral. It’s computed similarly to the positive and negative scores.</p></li>
<li><p>Compound Score (compound): The compound score is the sum of all lexicon ratings normalized between -1 and 1. This score is calculated using the formula:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\text{Compound Score} = \dfrac{\text{sum of the ratings}}{\text{sum of the squares of the ratings} + \text{alpha}}\]</div>
<p>​</p>
<p>Here, alpha is a normalization factor. The ratings are the scores of individual words in the lexicon. The compound score is then adjusted to be between -1 (most negative) and 1 (most positive).</p>
<p>Positive, negative, and neutral words are typically defined based on sentiment lexicons or dictionaries. These lexicons contain lists of words along with their associated sentiment polarity. Here’s a general explanation of how positive, negative, and neutral words are defined:</p>
<ul class="simple">
<li><p>Positive Words: Positive words are those that convey a positive sentiment or emotion. These words are often associated with concepts like happiness, joy, satisfaction, or approval. Examples of positive words include “happy,” “love,” “great,” “wonderful,” “awesome,” etc.</p></li>
<li><p>Negative Words: Negative words, on the other hand, convey a negative sentiment or emotion. They are associated with concepts like sadness, anger, disappointment, or disapproval. Examples of negative words include “sad,” “hate,” “terrible,” “awful,” “disappointing,” etc.</p></li>
<li><p>Neutral Words: Neutral words are those that do not carry a strong positive or negative sentiment. They are typically neutral in tone and can include words that are factual, descriptive, or contextually ambiguous. Examples of neutral words include “the,” “is,” “and,” “are,” “but,” etc.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sentiment_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s1">&#39;Negative&#39;</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Positive&#39;</span> <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Neutral&#39;</span>
<span class="n">news_type_name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="s1">&#39;Fake&#39;</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Not Fake&#39;</span>   
<span class="n">sid</span> <span class="o">=</span> <span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span>
<span class="n">sentiment_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
    <span class="n">sentiment_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="s1">&#39;compound&#39;</span><span class="p">])</span>
<span class="n">sentiment_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sentiment_scores</span><span class="p">)</span>
<span class="n">positive_news</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sentiment_scores</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">negative_news</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sentiment_scores</span> <span class="o">&lt;</span> <span class="o">-</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">neutral_news</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sentiment_scores</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sentiment_scores</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">))</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span> <span class="c1"># Z = 0 &lt;--&gt; neutral news</span>
<span class="n">Z</span><span class="p">[</span><span class="n">positive_news</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Z = 1 &lt;--&gt; positive news</span>
<span class="n">Z</span><span class="p">[</span><span class="n">negative_news</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Z = -1 &lt;--&gt; negative news</span>
<span class="n">prop_sentiment_class</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="p">{</span><span class="n">sentiment_name</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">Y</span><span class="o">==</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y</span><span class="p">)}</span>
<span class="n">prop_class_sentiment</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="n">news_type_name</span><span class="p">(</span><span class="n">c</span><span class="p">):</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">Z</span><span class="o">==</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Y</span><span class="p">)}</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_sentiment_class</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                 <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_sentiment_class</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_sentiment_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                 <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_sentiment_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Not Fake News&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Compound Score&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sentiment Type&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Sentiment Analysis of the News&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2065f3b8674670a2c13bea90b49c8a22f1a4100267e55e8e6a2240ca07d68533.png" src="_images/2065f3b8674670a2c13bea90b49c8a22f1a4100267e55e8e6a2240ca07d68533.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Interpretation</strong></p>
<ul>
<li><p>Fake news has a higher proportion of news with negative feelings than positive and neutral.</p></li>
<li><p>Not fake news have a higher proportion of news with positive feelings than negative and neutral.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                 <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                 <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> 
                 <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">prop_class_sentiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Negative&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Positive&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Compound Score&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;News Type&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Sentiment Analysis of the News&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a453ade8c96102058d705be3945876fe3d050fdb9c2a9967fe729cc20c30d674.png" src="_images/a453ade8c96102058d705be3945876fe3d050fdb9c2a9967fe729cc20c30d674.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Interpretation</strong></p>
<ul>
<li><p>Within the negative news the most part are fake news.</p></li>
<li><p>Within the positive news the most part are not fake news.</p></li>
<li><p>Within the neutral news the most part are fake news, and the different is quite significative.</p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fake News: Analysis and Detection</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction"><strong>Introduction</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data"><strong>Data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-topics"><strong>News topics</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-types"><strong>News types</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-words-per-news-type"><strong>Number of words per news type</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer"><strong>Tokenizer</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stopwords"><strong>Stopwords</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-tokens"><strong>Computing Tokens</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-number-of-tokens-per-news-type"><strong>Average number of tokens per news type</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-frequency"><strong>Top tokens per news type based on frequency</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-ratio"><strong>Odds Ratio</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-odds-ratio"><strong>Top tokens per news type based on Odds Ratio</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#term-frequecy-inverse-document-frequency"><strong>Term Frequecy - Inverse Document Frequency</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-tf-idf-with-a-toy-example"><strong>Understanding TF-IDF with a toy example</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-tf-idf"><strong>Computing TF-IDF</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-tokens-per-news-type-based-on-tf-idf"><strong>Top tokens per news type based on TF-IDF</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-our-tf-idf-values"><strong>Using our TF-IDF values</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#news-classification"><strong>News Classification</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-bayes-classifiers"><strong>Naive Bayes Classifiers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-naive-bayes"><strong>Gaussian Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multinomial-naive-bayes"><strong>Multinomial Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bernoulli-naive-bayes"><strong>Bernoulli Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-naive-bayes"><strong>Categorical Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complement-naive-bayes"><strong>Complement Naive Bayes</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tf-idf-naive-classifier"><strong>TF-IDF Naive Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-and-response-definition"><strong>Predictors and Response Definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outer-inner-evaluation-definition"><strong>Outer-Inner Evaluation Definition</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelines"><strong>Pipelines</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-grids"><strong>Parameter Grids</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hyper-parameter-optimization-hpo"><strong>Hyper-parameter Optimization (HPO)</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-tf-idf-classifier"><strong>Naive TF-IDF Classifier</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-classifier"><strong>KNN Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-naive-bayes-classifier"><strong>Gaussian Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multinomial-naive-bayes-classifier"><strong>Multinomial Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#complement-multinomial-naive-bayes-classifier"><strong>Complement Multinomial Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bernoulli-naive-bayes-classifier"><strong>Bernoulli Naive Bayes Classifier</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance">Estimation of future performance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis"><strong>Sentiment Analysis</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>